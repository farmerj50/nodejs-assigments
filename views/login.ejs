<html>

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.1/css/bootstrap.min.css">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.1/js/bootstrap.min.js"></script>
</head>
<style>
.container {
  width: 500px;
  clear: both;
}

.container input {
  width: 100%;
  clear: both;
}
</style>


<body>
    
        <div class="container">
        <form method="POST" action="/user/login" id="loginForm">
            <div class="md-form">
            <p>
                <label>Email</label>
                <input type="text" id="email" name="email" placeholder="Enter valid email." />
            </p>
            <p>
                <label>Password</label>
                <input type="password" id="password" name="password" placeholder="Enter valid password." />
            </p>
            <button>Login</button></br>
            <button>Register</button></br>
            <label>
            Product name
            <input type="text" placeholder="product name" name="productname"/>
        </label>
        </div>
    </p>
    <p>
        <label>
            Price
            <input type="text" placeholder="price" name="price"/>
        </label>
    </p>
    <label>
    Product name
    <input type="text" placeholder="product name" name="productname"/>
    </label>
    </p>
    <p>
    <label>
    Price
    <input type="text" placeholder="price" name="price"/>
    </label>
    </p>


    </form>
</div>

    <button id="getUser">Get user info</button>

    <button id="logout">Logout</button>

    <p id="profile"></p>

    <script>

        const loginForm = document.getElementById("loginForm");

        loginForm.addEventListener("submit", (event) => {
            console.log(event);
            event.preventDefault();

            const email = document.getElementById("email").value
            const password = document.getElementById("password").value

            console.log(email, password)

            fetch("/user/login", {
                method: "POST",
                headers: {
                    "content-type": "application/json"
                },
                body: JSON.stringify({
                    email: email,
                    password: password
                })
            })
                .then((response) => {
                    return response.json()
                })
                .then((data) => {
                    localStorage.setItem("token", data.token);
                })
        })

        document.getElementById("getUser").addEventListener("click", ()=>{
            fetch("/user/whoami", {
                method: "POST",
                headers: {
                    "content-type": "application/json",
                    "x-access-token" : localStorage.getItem("token")
                }
            })
                .then((response) => {
                    return response.json()
                })
                .then((data) => {
                    document.getElementById("profile").innerHTML = JSON.stringify(data);
                })
        })

        document.getElementById("logout").addEventListener("click", ()=>{
            localStorage.removeItem("token");
        })
        

        
    </script>
</body>

</html>